# Ch 01. 스프링, 클라우드와 만나다.
애플리케이션의 크기와 복잡성이 증가하기 시작하면 모놀리스를 관리하는 것은 어렵
모든 변경이 애플리케이션의 다른 부분까지 차례로 영향을 줄 수 있고, 운영 환경의 시스템에서는 더 많은 시간과 비용이 소요

￼
마이크로서비스란?
작고 느슨하게 결합된 분산 서비스이다. 대규모 애플리케이션 명확하고 관리하기 쉬운 구성요소로 분해할 수 있다.
작은 조각으로 분해-> 대규모 코드베이스 에서 발행하는 전통적 복잡정 문제 해결
분해와 분리(핵심 키워드) : 상호 독립적이어야한다.

특징
1. 로직은 명확하고 대등한 책임 경계가 있는 작은 컴포넌트로 분해된다
2. 각 구성 요소는 작은 책임 영역을 담당하고 서로 독립적 배포, 비즈니스의 도메인의 한 부분에 책임을 진다
3. 서비스 소비자와 공급자 간 데이터를 교환하고자 http,json 같은 경량의 통신 프로토콜을 사요한다
4. 기술 중립적 포맷을 사용해서 통신하기 때문에 서비스 하부의 기술 구현과 무관 -> 다양한 언어와 기술로 구현 가능하다
5. 작고 독집적이고 분산적인 마이크로서비스 특성 하나의 서비스에만 책임

구축방법
유연성: 분리된 서비스는 새로운 기능을 신속하게 제공하도록 구성하고 재배치 가능하다 코드가 적어지니까 복잡성도 낮아지고 코드의 테스트 및 배포시간도 줄어든다
회복성: 분리된 서비스란 애플리케이션이 더 이상 한 부분의 저하로 전체가 고장 나지않음
확장성: 여러 서버에 쉽게 수평 분산이 가능하므로 기능과 서비스를 적절히 확장하게 해준다.

구축과정
클라이언트가 요청을 시작하려면 액세스 토큰을 획득하기 위해 키클록에 인증을 받아야한다
토큰을 얻고 나서 클라이언트는 스프링 클라우드 api 게이트웨이에 요청을 보낸다
api 게이트웨이 서비스는 전체 아키텍처에 대한 진입점이다
유레카 서비스와 통신하여 조직 및 라이선스 서비스의 위치를 조회하고 해당 마이크로서비스를 호출한다.

키클록에 액세스 토큰의 유효성을 검증-> 요청처리할 수 있는 권한 여부 확인-> 디비의 정보 갱신, 조회 -> http응답
로그관리 -> 집킨
애플리케이션 지표 노출-> 프로메테우스, 그라파나

(노트 그루비 - 메이븐 그레들
 그레들은 프로젝트 구성을 선언하고자 메이븐 같은 xml 대신 그루비 기반사용
)
클라우드 컴퓨팅
Iaas , Caas, Paas, Faas, Saas

핵심 개발패턴

서비스 세분성: 서비스의 적정 책임 수준
통신 프로토콜: 클라이언트와 서비스가 데이터를 주고 받는 방식
인터페이스 설계: 서비스 엔드포인트를 클르아이언트에 노출하는 방식
서비스 간 이벤트 프로세싱: 서비스간 하드코딩된 의존성을 최소화 및 회복성을 높이기 위한 마이크로 서비스 분리하는 방법

라우팅 패턴:

클라우드 기반 애플리케이션 하나에 수백개의 마이크로 서비스 인스턴스가 실행 중일때 서비스의 물리적 IP주소 추상화하고 서비스호출에 대한 진입점
서비스 디스커버리(service discovery): 서비스 디스커버리와 핵심 기능인 서비스 레지스트리를 사용 -> 마이크로서비스를 탐색 가능. 
클라이언트에서 서비스의 물리적 위치 추상화한다. 새로운 인스턴스는 추가시키고 비정상 서비스 인스턴스는 제거시킨다.
서비스 라우팅(service routing): 클라이언트 권한 인증, 컨텐츠 검사 등 정책 시행 지점으로 사용되고 연결되는 논리적 단일 URL을 제공

클라이언트 회복성
클라이언트 부하 분산:서비스 디스커버리에서 조회한 마이크로 서비스 엔드포인트를 캐싱하고 서비스 호출이 인스턴스 간 분산 되도록
회로 차단기 패턴: 서비스 클라이언트가 비정상 반복호출 않도록
풀백 패턴:글라이언트가 데이터를 검색하거나 조치할 수 있는 대체 경로
벌크헤드패턴:하나의 오작동 서비스가 클라이언트의 모든 자원을 차지하지 않도록 클라이언트에서 다른 서비스 호출을 어떻게 격리하는지

보안 패턴
인증 : 서비스 클라이언트 확인
인가 : 서비스 클라이언트가 수행하려는 행동에 대한 수행 자격 여부 확인
자경 증명 관리와 전파 : 한 트랜잭션에서 여러 서비스를 호출할 때 계속해서 자격증명 x, OAuth, JWT

로깅 및 트레이싱 패턴 
로그 상관관계 : 모든 서비스의 로그 항목에 상관관계 id, id 해당 트랜잭션내 관련된 로그 항목 연결
로그 수집 : 모든 서비스 인스턴스에서 모든 로그 수집
마이크로서비스 추적 : 트랜잭션을 찾기 위해 로그 데이터를 질의, 트랜잭션과 연관된 모든 서비스 통과

지표패턴
지표: 애플리케이션 상태에 대해 중요한 정보를 생성하고 , 지표에 노출
지표 서비스: 애플리케이션 지표를 저장하고 질의하는 곳
지표 시각화 제품군: 애플리케이션과 인프라스트럭처에 대해 비지니스와 연관된 시계열 데이터를 시각화 --?/....

빌드/배포 패턴
빌드 및 배포 파이프라인: 조직의 모든 환경에서 원클릭 빌드와 배포를 강조하는 반복 가능한 빌드 및 배포 프로세스 구축하는 방법
코드형 인프라스트럭처: 소스 제어를 사용해 실행하고 관리할 수 있는 코드로 서비스 프로비저닝(필요시 배포해두었던 시스템 바로시작)을 처리하는 방법
불변서버: 마이크로서비스 이미지를 생성하고 배포한 후 변경하지 못하게 하는 방법
피닉스 서버: 개별 컨테이너를 실행하는 서버가 정기적으로 분해되어 불변 이미지로 재생성되도록 하는 방법